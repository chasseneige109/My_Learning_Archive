# Pad Masking
## 1. ì‹œì‘ì : ìì—°ì–´ ì‹œí€€ìŠ¤ì˜ ê·¼ë³¸ì ì¸ ë¬¸ì œ

ìì—°ì–´ ë¬¸ì¥ì€ **ê¸¸ì´ê°€ ì œê°ê°**ì´ì—ìš”.

- â€œHiâ€ â†’ ê¸¸ì´ 2
    
- â€œI love deep learningâ€ â†’ ê¸¸ì´ 4
    
- â€œì´ ëª¨ë¸ì€ íŒ¨ë”©ì— ëŒ€í•´ ë¬¼ì–´ë³´ëŠ” ì‚¬ìš©ìì˜ ì§ˆë¬¸ì— ìƒë‹¹íˆ ê¸¸ê²Œ ë‹µë³€í•œë‹¤â€ â†’ í›¨ì”¬ ê¹€
    

ê·¸ëŸ°ë° GPUì—ì„œ ì—°ì‚°ì„ í•  ë•ŒëŠ”:

- ë³´í†µ `batch_size x seq_len x hidden_dim` ê°™ì€ **ì§ì‚¬ê°í˜• í…ì„œ**ë¥¼ í•œ ë²ˆì— ì²˜ë¦¬.
    
- í…ì„œì˜ ë‘ ë²ˆì§¸ ì°¨ì›(ì‹œí€€ìŠ¤ ê¸¸ì´)ì´ **ëª¨ë“  ìƒ˜í”Œì—ì„œ ê°™ì•„ì•¼** í•¨.
    

> ì¦‰, **ìˆ˜í•™ì ìœ¼ë¡œë„, êµ¬í˜„ì ìœ¼ë¡œë„ â€œë³€ìˆ˜ ê¸¸ì´ í…ì„œâ€ë¥¼ í•œ ë²ˆì— ì²˜ë¦¬í•˜ê¸°ê°€ ê¹Œë‹¤ë¡­ê¸° ë•Œë¬¸ì—**  
> ê¸¸ì´ë¥¼ ê°•ì œë¡œ ë§ì¶”ëŠ” ì¥ì¹˜ê°€ í•„ìš” â†’ ê·¸ê²Œ `padding token`.

---

## 2. â€œê·¸ëŸ¼ ê·¸ëƒ¥ í•œ ë¬¸ì¥ì”© ì²˜ë¦¬í•˜ë©´ ë˜ì§€ ì•Šë‚˜ìš”?â€

ì´ë¡ ì ìœ¼ë¡œëŠ” ê°€ëŠ¥í•´ìš”. í•˜ì§€ë§Œ:

1. **GPU ë³‘ë ¬ì²˜ë¦¬ íš¨ìœ¨ì´ ë°•ì‚´ë‚©ë‹ˆë‹¤**
    
    - ë”¥ëŸ¬ë‹ì€ `batch` ë‹¨ìœ„ë¡œ í–‰ë ¬ ê³±ì„ ëŒë¦¬ë©´ì„œ GPUë¥¼ ê½‰ ì±„ì›Œì•¼ ë¹ ë¦„.
        
    - ë¬¸ì¥ í•˜ë‚˜ì”© ë„£ìœ¼ë©´ ì—°ì‚°ëŸ‰ì´ ë„ˆë¬´ ì‘ì•„ì„œ GPUê°€ ë…¸ëŠ” ì‹œê°„ì´ ë§ì•„ì§.
        
2. **í†µê³„ì ìœ¼ë¡œë„ ë°°ì¹˜ í•™ìŠµì´ ìœ ë¦¬**
    
    - Batch Normalizationì´ë‚˜ LayerNorm, gradient estimation ë“±
        
    - ì—¬ëŸ¬ ìƒ˜í”Œì˜ ì†ì‹¤ì„ í‰ê· ë‚´ë©° ë¯¸ë‹ˆë°°ì¹˜ ë‹¨ìœ„ë¡œ í•™ìŠµí•˜ëŠ” ê²ƒì´ ì•ˆì •ì ì„.
        

ê·¸ë˜ì„œ í˜„ì‹¤ì ì¸ ì„ íƒì€:

> â€œ**ì—¬ëŸ¬ ë¬¸ì¥ì„ í•œ í…ì„œì— ë„£ì–´ì•¼ í•œë‹¤ â†’ ê¸¸ì´ë¥¼ ë§ì¶°ì•¼ í•œë‹¤**â€

ê·¸ë¦¬ê³  ê¸¸ì´ë¥¼ ë§ì¶”ê¸° ìœ„í•œ ê°€ì¥ ë‹¨ìˆœÂ·ì¼ë°˜ì ì¸ í•´ê²°ì±…:

> **ì§§ì€ ë¬¸ì¥ì˜ ë’¤ë¥¼ â€˜ì˜ë¯¸ ì—†ëŠ” í† í°â€™ìœ¼ë¡œ ì±„ìš´ë‹¤ â†’ padding token**

## âœ… í•„ìˆ˜ ì¡°ê±´ 1. Key PAD mask

> ì •ìƒ tokenì´ PADë¥¼ ë³´ì§€ ëª»í•˜ê²Œ ë§‰ìŒ

`attention_mask = (input_ids != PAD)  # key ê¸°ì¤€`

ì´ê±´ **í•­ìƒ í•„ìš”**.

---

## âœ… í•„ìˆ˜ ì¡°ê±´ 2. Loss mask (ì´ê²Œ ì œì¼ ì¤‘ìš”)

> PAD ìœ„ì¹˜ì—ì„œëŠ” **ì ˆëŒ€ lossë¥¼ ê³„ì‚°í•˜ì§€ ì•ŠìŒ**

`loss = (token_loss * (labels != PAD)).sum() / valid_token_count`

âœ… ì´ê²Œ ì—†ìœ¼ë©´ ëª¨ë“  ê²Œ ë¬´ë„ˆì§.

---

## âœ… í•„ìˆ˜ ì¡°ê±´ 3. (ê¶Œì¥) Embedding layerì—ì„œ padding_idx ì§€ì •

`nn.Embedding(vocab_size, d, padding_idx=PAD)`

- PAD embeddingì€ gradient ìì²´ê°€ 0
    
- â€œì‹¤ìˆ˜ ë°©ì§€ìš© ì•ˆì „ì¥ì¹˜â€
    

---

## âœ… ê¶Œì¥ ì¡°ê±´ 4. Encoder/Decoder ëª¨ë‘ì—ì„œ mask ì¼ê´€ì„± ìœ ì§€

- Encoder self-attention
    
- Decoder self-attention
    
- Cross-attention
    

ğŸ‘‰ **ëª¨ë“  attention blockì—ì„œ PAD mask ì ìš©**