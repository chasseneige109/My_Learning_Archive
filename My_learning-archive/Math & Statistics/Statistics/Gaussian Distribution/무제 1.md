다변량 정규분포(Multivariate Normal Distribution, MVN) 식의 유도는 **"가장 단순한 정규분포(표준 정규분포)를 선형 변환(Linear Transformation)하여 늘리고 회전시킨 것"**이라는 관점에서 출발하면 아주 깔끔하게 이해할 수 있습니다.

유도 과정은 크게 3단계로 나뉩니다.

1. **재료 준비:** 서로 독립인 표준 정규분포들의 결합 확률 ($Z$)
    
2. **변환:** 행렬 $A$를 곱해서 모양을 바꾸기 ($X = AZ + \mu$)
    
3. **보정:** 변수 변환에 따른 확률 밀도 크기 보정 (**Jacobian**)
    

---

### 1단계: 재료 준비 (독립적인 표준 정규분포 $Z$)

가장 쉬운 상태에서 시작합니다. $D$차원 벡터 $Z$가 있고, 각 성분 $z_i$가 서로 독립이며 표준 정규분포를 따른다고 가정합시다.

$$z_i \sim \mathcal{N}(0, 1) \quad \text{(평균 0, 분산 1)}$$

이들의 결합 확률 밀도 함수(Joint PDF)는 단순히 각 PDF의 **곱**입니다.

$$\begin{aligned} p(Z) &= \prod_{i=1}^D \frac{1}{\sqrt{2\pi}} e^{-\frac{1}{2} z_i^2} \\ &= \frac{1}{(2\pi)^{D/2}} e^{-\frac{1}{2} \sum z_i^2} \end{aligned}$$

이것을 행렬(벡터) 표기로 바꾸면 아주 깔끔해집니다. ($\sum z_i^2 = Z^T Z$)

$$p(Z) = \frac{1}{(2\pi)^{D/2}} e^{-\frac{1}{2} Z^T Z} \quad \dots \text{(식 1)}$$

---

### 2단계: 변환 (모양 만들기 $Z \rightarrow X$)

이제 이 동그란 분포($Z$)를 찌그러뜨리고($A$) 이동($\mu$)시켜서 우리가 원하는 분포($X$)로 만듭니다.

$$X = AZ + \mu$$

여기서 $A$는 $D \times D$ 행렬이고, $\mu$는 평균 벡터입니다.

이때 $X$의 분산(공분산 행렬 $\Sigma$)은 다음과 같이 정의됩니다.

$$\Sigma = \text{Cov}(X) = E[(AZ)(AZ)^T] = A E[ZZ^T] A^T = A I A^T = AA^T$$

(즉, $\Sigma = AA^T$ 입니다. $A$는 공분산의 제곱근 같은 존재입니다.)

이제 **(식 1)**의 $Z$ 자리에 $X$를 집어넣어야 합니다. 역함수를 구합니다.

$$Z = A^{-1}(X - \mu)$$

이걸 **지수(exponent) 부분**인 $Z^T Z$에 대입해 봅시다.

$$\begin{aligned} Z^T Z &= (A^{-1}(X - \mu))^T (A^{-1}(X - \mu)) \\ &= (X - \mu)^T (A^{-1})^T A^{-1} (X - \mu) \\ &= (X - \mu)^T (AA^T)^{-1} (X - \mu) \\ &= \mathbf{(X - \mu)^T \Sigma^{-1} (X - \mu)} \end{aligned}$$

오! 식의 뒷부분(지수 항)이 완성되었습니다.

---

### 3단계: 보정 (Jacobian Determinant) - 여기가 핵심!

확률 밀도 함수에서 변수를 바꿀 때($Z \to X$)는 단순히 식만 대입하면 안 되고, **공간의 부피 변화율**을 반영해 줘야 합니다.

- 예: 스펀지를 2배로 늘리면($X=2Z$), 밀도(농도)는 절반으로 묽어집니다.
    
- 수학 공식: $p(X) = p(Z) \times |\det(\frac{dZ}{dX})|$ (야코비안의 절댓값)
    

우리의 관계식은 $Z = A^{-1}(X - \mu)$ 이므로, 미분(Jacobian Matrix)은 $A^{-1}$입니다.

$$\left| \det\left( \frac{dZ}{dX} \right) \right| = |\det(A^{-1})| = \frac{1}{|\det(A)|}$$

그런데 아까 $\Sigma = AA^T$라고 했으므로, 행렬식의 성질에 의해:

$$|\Sigma| = \det(AA^T) = \det(A)\det(A^T) = (\det(A))^2$$

$$\therefore |\det(A)| = \sqrt{|\Sigma|} = |\Sigma|^{1/2}$$

따라서 부피 보정 계수는 다음과 같습니다.

$$\frac{1}{|\Sigma|^{1/2}}$$

---

### 4단계: 최종 합체

이제 1단계의 식에 2단계(지수 변환)와 3단계(계수 보정)를 모두 적용합니다.

1. **원래 상수:** $(2\pi)^{-D/2}$
    
2. **부피 보정:** $|\Sigma|^{-1/2}$
    
3. **지수 부분:** $\exp \left( -\frac{1}{2} (X - \mu)^T \Sigma^{-1} (X - \mu) \right)$
    

이들을 다 곱하면 우리가 아는 그 식이 나옵니다.

$$\mathcal{N}(x; \mu, \Sigma) = \frac{1}{(2\pi)^{D/2} |\Sigma|^{1/2}} \exp \left( -\frac{1}{2} (x - \mu)^T \Sigma^{-1} (x - \mu) \right)$$

### 요약

다변량 정규분포 식은 하늘에서 뚝 떨어진 게 아니라,

1. **$e^{-z^2/2}$ (기본 정규분포)**에
    
2. **$(x-\mu)^T \Sigma^{-1} (x-\mu)$ (마할라노비스 거리)**를 대입하여 거리 개념을 바꾸고,
    
3. **$|\Sigma|^{-1/2}$ (행렬식)**으로 늘어난 부피만큼 밀도를 낮춰준 결과물입니다.